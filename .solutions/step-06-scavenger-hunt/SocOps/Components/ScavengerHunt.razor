@using SocOps.Data

<div class="flex flex-col min-h-full">
    <!-- Header -->
    <header class="flex items-center justify-between p-3 bg-card border-b border-cyan">
        <button
            @onclick="OnBack"
            class="text-cyan text-sm px-3 py-1.5 rounded border border-cyan transition-all hover:shadow-neon">
            ‚Üê EXIT
        </button>
        <h1 class="font-bold text-cyan font-display tracking-wider neon-text">SCAVENGER HUNT</h1>
        <div class="w-16"></div>
    </header>

    <!-- Progress Bar -->
    <div class="p-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-cyan font-display text-sm">PROGRESS</span>
            <span class="text-magenta font-display text-sm">@CompletedCount / @TotalCount</span>
        </div>
        <div class="h-3 bg-card rounded-lg overflow-hidden neon-border">
            <div 
                class="h-full bg-accent transition-all duration-300"
                style="width: @ProgressPercentage%">
            </div>
        </div>
    </div>

    <!-- Quest List -->
    <div class="flex-1 overflow-y-auto p-4 space-y-2">
        @foreach (var item in Items)
        {
            <button 
                @onclick="() => ToggleItem(item)"
                class="w-full flex items-center gap-3 p-3 bg-card rounded-lg border @(item.IsCompleted ? "border-cyan neon-border" : "border-gray-200") transition-all hover:border-cyan">
                <div class="w-6 h-6 rounded border-2 @(item.IsCompleted ? "border-cyan bg-cyan" : "border-gray-500") flex items-center justify-center transition-all">
                    @if (item.IsCompleted)
                    {
                        <span class="text-bg-dark font-bold">‚úì</span>
                    }
                </div>
                <span class="flex-1 text-left @(item.IsCompleted ? "text-cyan line-through opacity-70" : "text-white")">
                    @item.Text
                </span>
            </button>
        }
    </div>

    <!-- Completion Message -->
    @if (IsComplete)
    {
        <div class="p-4 bg-card border-t border-magenta">
            <div class="text-center">
                <span class="text-3xl mb-2 block">üéâ</span>
                <p class="text-magenta font-display neon-text-pink">MISSION COMPLETE!</p>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public EventCallback OnBack { get; set; }

    private List<ScavengerItem> Items { get; set; } = new();
    
    private int CompletedCount => Items.Count(i => i.IsCompleted);
    private int TotalCount => Items.Count;
    private double ProgressPercentage => TotalCount > 0 ? (CompletedCount * 100.0 / TotalCount) : 0;
    private bool IsComplete => CompletedCount == TotalCount && TotalCount > 0;

    protected override void OnInitialized()
    {
        // Shuffle and take first 15 questions for scavenger hunt
        var random = new Random();
        Items = Questions.QuestionsList
            .OrderBy(_ => random.Next())
            .Take(15)
            .Select((q, i) => new ScavengerItem { Id = i, Text = q })
            .ToList();
    }

    private void ToggleItem(ScavengerItem item)
    {
        item.IsCompleted = !item.IsCompleted;
    }

    private class ScavengerItem
    {
        public int Id { get; set; }
        public string Text { get; set; } = "";
        public bool IsCompleted { get; set; }
    }
}
