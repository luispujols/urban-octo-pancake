@page "/"
@using SocOps.Models
@using SocOps.Services
@inject BingoGameService GameService
@implements IDisposable

<PageTitle>Soc Ops - Social Bingo</PageTitle>

@if (GameService.CurrentGameState == GameState.Start)
{
    <StartScreen OnStart="@GameService.StartGame" />
}
else
{
    <GameScreen
        Board="@GameService.Board"
        WinningSquareIds="@GameService.WinningSquareIds"
        HasBingo="@(GameService.CurrentGameState == GameState.Bingo)"
        OnSquareClick="@GameService.HandleSquareClick"
        OnReset="@GameService.ResetGame" />

    @if (GameService.ShowBingoModal)
    {
        <BingoModal OnDismiss="@GameService.DismissModal" />
    }
}

@code {
    protected override async Task OnInitializedAsync()
    {
        await GameService.InitializeAsync();
        GameService.OnStateChanged += StateHasChanged;
    }

    public void Dispose()
    {
        GameService.OnStateChanged -= StateHasChanged;
    }
}
