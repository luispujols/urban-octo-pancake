@page "/"
@using SocOps.Models
@using SocOps.Services
@using SocOps.Components
@inject BingoGameService GameService
@implements IDisposable

<PageTitle>Soc Ops - Social Bingo</PageTitle>

@if (GameService.CurrentGameState == GameState.Start)
{
    <StartScreen OnModeSelected="@HandleModeSelected" />
}
else if (GameService.CurrentGameState == GameState.ScavengerHunt)
{
    <ScavengerHunt OnBack="@GameService.ResetGame" />
}
else if (GameService.CurrentGameState == GameState.CardDeck)
{
    <CardDeck OnBack="@GameService.ResetGame" />
}
else
{
    <GameScreen
        Board="@GameService.Board"
        WinningSquareIds="@GameService.WinningSquareIds"
        HasBingo="@(GameService.CurrentGameState == GameState.Bingo)"
        OnSquareClick="@GameService.HandleSquareClick"
        OnReset="@GameService.ResetGame" />

    @if (GameService.ShowBingoModal)
    {
        <BingoModal OnDismiss="@GameService.DismissModal" />
    }
}

@code {
    protected override async Task OnInitializedAsync()
    {
        await GameService.InitializeAsync();
        GameService.OnStateChanged += StateHasChanged;
    }

    private void HandleModeSelected(GameMode mode)
    {
        GameService.StartGame(mode);
    }

    public void Dispose()
    {
        GameService.OnStateChanged -= StateHasChanged;
    }
}
