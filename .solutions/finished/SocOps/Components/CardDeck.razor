@using SocOps.Data

<div class="flex flex-col min-h-full">
    <!-- Header -->
    <header class="flex items-center justify-between p-3 bg-card border-b border-cyan">
        <button
            @onclick="OnBack"
            class="text-cyan text-sm px-3 py-1.5 rounded border border-cyan transition-all hover:shadow-neon">
            ‚Üê EXIT
        </button>
        <h1 class="font-bold text-cyan font-display tracking-wider neon-text">CARD DECK</h1>
        <button
            @onclick="ResetDeck"
            class="text-magenta text-sm px-3 py-1.5 rounded border border-magenta transition-all hover:shadow-neon">
            SHUFFLE
        </button>
    </header>

    <!-- Card Area -->
    <div class="flex-1 flex items-center justify-center p-6">
        <div class="w-full max-w-xs perspective-1000">
            <!-- Flippable Card Container -->
            <div class="card-flip @(IsFlipped ? "flipped" : "")" @onclick="HandleCardTap">
                <!-- Card Inner (holds both faces) -->
                <div class="card-flip-inner">
                    <!-- Card Back - Tap to Reveal -->
                    <div class="card-face card-back bg-card rounded-2xl neon-border p-8 flex flex-col items-center justify-center">
                        <div class="text-6xl mb-4">üé¥</div>
                        <p class="text-cyan font-display uppercase tracking-wider text-lg">TAP TO REVEAL</p>
                    </div>
                    
                    <!-- Card Front - Question -->
                    <div class="card-face card-front bg-card rounded-2xl neon-border-pink p-8 flex flex-col items-center justify-center text-center">
                        <p class="text-xl font-semibold text-white mb-6 leading-relaxed">
                            @CurrentQuestion
                        </p>
                        <p class="text-sm text-gray-500 font-display uppercase">
                            Find someone who...
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    @if (IsFlipped && !IsAllDone)
    {
        <div class="p-4 flex gap-4">
            <button
                @onclick="() => HandleResult(false)"
                class="flex-1 py-4 bg-card border border-magenta rounded-lg text-magenta font-display uppercase tracking-wider transition-all hover:shadow-neon">
                ‚úó NO MATCH
            </button>
            <button
                @onclick="() => HandleResult(true)"
                class="flex-1 py-4 bg-card border border-cyan rounded-lg text-cyan font-display uppercase tracking-wider transition-all hover:shadow-neon">
                ‚úì FOUND ONE
            </button>
        </div>
    }

    <!-- Stats -->
    <div class="p-4 bg-card border-t border-cyan">
        <div class="flex justify-around text-center">
            <div>
                <div class="text-2xl font-bold text-cyan neon-text">@MatchCount</div>
                <div class="text-xs text-gray-500 font-display uppercase">Matches</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-magenta neon-text-pink">@SkipCount</div>
                <div class="text-xs text-gray-500 font-display uppercase">Skipped</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-white">@CardsRemaining</div>
                <div class="text-xs text-gray-500 font-display uppercase">Remaining</div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback OnBack { get; set; }

    private List<string> Deck = new();
    private int CurrentIndex = 0;
    private bool IsFlipped = false;
    private int MatchCount = 0;
    private int SkipCount = 0;

    private string CurrentQuestion => CurrentIndex < Deck.Count ? Deck[CurrentIndex] : "All done! üéâ";
    private int CardsRemaining => Math.Max(0, Deck.Count - CurrentIndex);
    private bool IsAllDone => CurrentIndex >= Deck.Count;

    protected override void OnInitialized()
    {
        ShuffleDeck();
    }

    private void ShuffleDeck()
    {
        var random = new Random();
        Deck = Questions.QuestionsList.OrderBy(_ => random.Next()).ToList();
        CurrentIndex = 0;
        IsFlipped = false;
    }

    private void ResetDeck()
    {
        ShuffleDeck();
        MatchCount = 0;
        SkipCount = 0;
    }

    private void HandleCardTap()
    {
        if (!IsFlipped && !IsAllDone)
        {
            IsFlipped = true;
        }
    }

    private void HandleResult(bool isMatch)
    {
        if (isMatch)
            MatchCount++;
        else
            SkipCount++;

        CurrentIndex++;
        IsFlipped = false;
    }
}

<style>
    .perspective-1000 {
        perspective: 1000px;
    }
    
    .card-flip {
        width: 100%;
        height: 320px;
        cursor: pointer;
    }
    
    .card-flip-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform-style: preserve-3d;
    }
    
    .card-flip.flipped .card-flip-inner {
        transform: rotateY(180deg);
    }
    
    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
    }
    
    .card-back {
        transform: rotateY(0deg);
    }
    
    .card-front {
        transform: rotateY(180deg);
    }
</style>
